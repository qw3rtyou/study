# 키워드
- 알고리즘
- 램덤시드

---
# 문제 배경
- 해당 문제의 소스코드를 보면 random을 이용해 flag값을 섞은 후, 섞은 값을 shuffled_flag.txt에 저장 후 유저에게 주어진다.
- 이때, `seed` 값이 고정이 되어 있으므로 섞는 순서는 고정이 되고, 전부 섞였을 때, index 번호만 알 수 있다면, 복호화가 가능하다.

```python
import random

def make_fake_flag() :
    flag = "KCTF{"
    flag += "X" * (1024 - 6)
    flag += "}"
    return flag

def reaplce_2_real_flag(flag):
    list_flag = [a for a in flag]
    flag = list_flag
    for i in range(len(flag)):
        if flag[i] == "X":
            flag[i] = hex(random.randint(0,15))[2:]
    return flag

def random_shuffle(flag,seed) :
    random.seed(seed)
    rand = random.randint(70,90)
    for _ in range(rand):
        random.seed(seed)
        random.shuffle(flag)

    return "".join(flag)
        

if __name__ == "__main__" :
    print("[+] yeonwoo is shuffling flag ^-^")
    flag = make_fake_flag()
    flag = reaplce_2_real_flag(flag)
    with open("./real_flag.txt","w") as f :
        f.write(''.join(flag))
        f.close()
        
    flag = random_shuffle(flag,31208)

    formats = "KCTF{}"

    with open("./shuffled_flag.txt","w") as f :
        f.writelines(flag)
        f.close()

    print("[+] done! can you find the real flag? ^-^")
```

---
# 풀이과정
- 역산이 어렵지만, 섞는 순서자체를 기억하여 문제를 해결하였음


```python
import random

actions=[133, 642, 796, 504, 505, 157, 334, 829, 405, 26, 480, 827, 822, 678, 126, 107, 720, 348, 217, 685, 740, 528, 445, 587, 204, 161, 999, 507, 733, 47, 810, 820, 870, 491, 3, 719, 554, 761, 351, 425, 112, 220, 95, 430, 287, 873, 908, 363, 142, 580, 1019, 853, 954, 15, 613, 1000, 672, 353, 402, 1003, 171, 470, 831, 266, 499, 330, 557, 627, 983, 787, 910, 723, 811, 121, 255, 152, 477, 674, 644, 19, 968, 164, 969, 292, 722, 588, 976, 82, 551, 382, 798, 55, 213, 248, 214, 553, 664, 982, 772, 923, 233, 767, 681, 994, 602, 869, 210, 865, 758, 237, 283, 341, 349, 34, 212, 388, 519, 487, 542, 635, 1007, 22, 291, 807, 626, 465, 176, 459, 749, 228, 938, 1016, 925, 456, 178, 871, 568, 836, 468, 530, 763, 840, 575, 842, 556, 203, 679, 803, 278, 546, 918, 70, 433, 200, 764, 250, 785, 896, 515, 791, 506, 730, 23, 913, 10, 29, 595, 166, 46, 890, 543, 438, 299, 566, 844, 665, 104, 632, 660, 597, 33, 323, 263, 389, 63, 8, 76, 198, 769, 527, 86, 285, 473, 648, 155, 614, 139, 804, 560, 690, 839, 113, 823, 848, 583, 94, 281, 964, 240, 83, 301, 950, 537, 293, 878, 966, 59, 975, 108, 1015, 594, 276, 703, 423, 414, 995, 852, 780, 656, 201, 617, 335, 874, 531, 501, 956, 370, 927, 864, 578, 190, 79, 935, 936, 290, 817, 934, 845, 169, 609, 422, 687, 216, 606, 409, 550, 151, 779, 441, 377, 484, 1005, 962, 800, 177, 638, 889, 960, 940, 9, 410, 367, 488, 346, 123, 888, 841, 850, 637, 337, 122, 376, 916, 745, 447, 1010, 360, 381, 861, 943, 899, 572, 308, 306, 1001, 777, 256, 799, 156, 548, 961, 416, 774, 148, 790, 192, 331, 691, 885, 391, 215, 458, 2, 92, 715, 752, 236, 304, 559, 184, 891, 314, 189, 765, 342, 384, 972, 987, 318, 591, 313, 57, 380, 1021, 826, 946, 69, 523, 830, 882, 736, 901, 706, 518, 895, 495, 74, 797, 835, 51, 522, 563, 328, 647, 540, 224, 600, 332, 675, 289, 160, 253, 25, 816, 373, 727, 311, 721, 593, 181, 361, 932, 739, 191, 933, 493, 875, 770, 211, 309, 242, 634, 939, 419, 49, 174, 768, 746, 598, 316, 509, 707, 756, 979, 232, 713, 106, 801, 502, 611, 395, 879, 692, 344, 724, 275, 475, 967, 153, 252, 80, 970, 516, 415, 650, 131, 297, 345, 448, 653, 355, 48, 742, 352, 440, 743, 472, 959, 429, 718, 584, 494, 524, 789, 30, 28, 1018, 270, 625, 305, 81, 616, 629, 977, 109, 1009, 73, 383, 295, 149, 937, 621, 945, 917, 571, 100, 347, 837, 651, 454, 128, 369, 630, 187, 781, 694, 624, 996, 461, 693, 709, 5, 116, 243, 636, 435, 851, 310, 582, 114, 552, 453, 150, 782, 467, 431, 350, 466, 432, 544, 96, 794, 303, 420, 426, 91, 340, 272, 884, 545, 130, 103, 60, 1017, 620, 619, 605, 971, 569, 655, 1014, 784, 688, 219, 307, 141, 101, 728, 56, 599, 239, 700, 482, 31, 245, 397, 915, 199, 1008, 268, 443, 386, 753, 981, 561, 904, 510, 538, 951, 689, 990, 953, 0, 670, 407, 657, 317, 358, 327, 825, 208, 227, 702, 534, 590, 202, 446, 525, 900, 1022, 641, 640, 71, 437, 754, 496, 737, 88, 903, 67, 725, 926, 833, 115, 533, 167, 4, 455, 1011, 249, 13, 64, 427, 85, 339, 931, 868, 783, 298, 449, 238, 857, 338, 732, 209, 50, 41, 698, 824, 365, 497, 205, 957, 567, 99, 880, 786, 408, 776, 704, 428, 442, 140, 649, 898, 436, 930, 390, 773, 645, 279, 809, 555, 374, 154, 462, 21, 271, 398, 514, 320, 705, 235, 919, 72, 359, 980, 952, 955, 858, 434, 912, 788, 439, 241, 471, 517, 78, 806, 129, 43, 997, 144, 618, 699, 677, 175, 673, 958, 526, 866, 326, 541, 65, 75, 949, 145, 610, 511, 671, 608, 84, 843, 652, 669, 77, 998, 469, 695, 883, 892, 792, 701, 396, 886, 206, 464, 601, 117, 818, 658, 585, 230, 513, 52, 586, 914, 229, 579, 264, 159, 778, 179, 573, 490, 387, 508, 928, 119, 795, 646, 401, 846, 489, 32, 478, 385, 262, 662, 965, 120, 859, 710, 147, 564, 20, 581, 183, 226, 755, 907, 124, 659, 821, 288, 300, 137, 277, 536, 222, 860, 897, 978, 941, 989, 379, 400, 225, 322, 922, 948, 738, 731, 11, 667, 993, 814, 66, 832, 834, 172, 280, 512, 476, 604, 168, 372, 680, 872, 1020, 17, 6, 294, 1, 254, 413, 185, 751, 520, 924, 760, 110, 354, 14, 162, 483, 207, 274, 234, 682, 404, 717, 247, 118, 134, 45, 35, 532, 418, 876, 623, 188, 196, 89, 231, 58, 286, 463, 547, 663, 729, 539, 676, 193, 481, 125, 654, 503, 639, 762, 366, 838, 615, 711, 631, 1012, 93, 343, 812, 854, 498, 221, 329, 257, 261, 452, 992, 974, 260, 132, 371, 991, 988, 577, 893, 607, 479, 815, 61, 194, 775, 368, 828, 399, 867, 929, 186, 856, 378, 881, 105, 596, 44, 684, 1002, 963, 986, 321, 633, 741, 282, 748, 393, 849, 244, 39, 296, 492, 40, 589, 136, 325, 246, 944, 258, 315, 696, 197, 267, 324, 356, 16, 457, 1013, 793, 36, 90, 744, 173, 1004, 421, 947, 424, 38, 906, 460, 813, 683, 18, 712, 592, 259, 757, 500, 819, 265, 284, 165, 734, 984, 877, 485, 628, 894, 622, 302, 111, 7, 668, 394, 535, 138, 766, 417, 855, 411, 333, 909, 180, 747, 62, 863, 905, 37, 195, 808, 357, 312, 163, 771, 158, 486, 529, 802, 170, 269, 661, 403, 336, 750, 392, 574, 708, 902, 805, 562, 375, 887, 12, 97, 182, 87, 942, 24, 716, 973, 521, 714, 612, 576, 135, 570, 143, 565, 412, 549, 643, 726, 68, 666, 474, 921, 1023, 223, 558, 251, 364, 1006, 319, 603, 735, 406, 920, 444, 218, 27, 127, 42, 450, 53, 146, 911, 273, 362, 862, 697, 98, 847, 686, 102, 985, 54, 759, 451]

def reverse_shuffle(s):
    restored = ['']*len(s)
    for i, j in enumerate(actions):
        restored[j] = s[i]
    return ''.join(restored)

if __name__ == "__main__":
    shuffled_flag_file = "shuffled_flag_origin.txt"
    real_flag_file = "real_flag.txt"

    with open(shuffled_flag_file, "r") as f:
        shuffled_flag = f.read().strip()

    shuffled_flag = [a for a in shuffled_flag]
    print(shuffled_flag)

    real_flag = reverse_shuffle(shuffled_flag)
    print(real_flag)

    # with open(real_flag_file, "w") as f:
    #     f.write(real_flag)

    # print("Real flag has been obtained and saved in real_flag.txt.")


#KCTF{72f6bb3aed5a0d5dc2bd89c8c6f35fb56739fbf16eeecbc0cd8394092ac56aab979fbdbef57efed09472948303f2e8565e6d6dc150821d04871716e76f775efb5869b040b1b9930bbf7ba16b258ad2dcc7f05e79d4321c0378d00950d31b7ddd7739211c1d2cebf9287d9eec9dd16a958086cb74f463d09a4414bcfc47bbb3626ddba2bc53dc379e680940508e83f109a75b79e91d6bdb0e54d6425fc77c6a3e4ca8cd14d469e3c9bafedcd3573865df88b08c1413e00177b38fe05292a5cf3758a0fdf8f1a33a0974b14d244003ad2701ad2b874920900f4042e5bb9bb07f10d955c1408277be3e1c4a5ec151c73fffacc046ac87030649e2887dd07cf02d6a29ccd321880438e9ddd6e23c0b9026c46f461d2fe7423e01551ee2f22f59a2019dead3d9e551021fa0057f5ec748c84d33086e93bb77a9a440664640ec33d61239a912d7a3b5c670ac32c7d70e124db95b12a210553200720f6d90b7b5844a19f2adb81a9d1178387cb4a699c15550cff94f8767903b7abe567eaa9aeb5fc41034132b9b7ed31603a4d5995fc3a678972dbb7d10e51e0dc133a5270181cb819975b976c294c5221f300304a9f9cd4805301464333b0c620198b30341eeb3defb4e33b2ea9cf4e253dcdb6ab3561c5f2b09942e3ec8ca46565f9d6c03161e4742f1472dd147257f33deba50c6b7e115d8a8c1af4e329003a8edb1dc04ad}
```


---
# 다른 풀이(n0paew)

```python
import random

def reverse_shuffle(shuffled_flag, seed):
    random.seed(seed)
    rand = random.randint(70, 90)
    indices = list(range(len(shuffled_flag)))
    for _ in range(rand):
        random.seed(seed)
        random.shuffle(indices)
    
    index = {}
    for i, j in zip(shuffled_flag, indices):
        index[j] = i
    flag = [index[i] for i in range(len(index.keys()))]
    return "".join(flag)

shuffled_flag = "56f8724879703bfc1395f49dcdcdced10aF1da322cf986a11103c53126a47cc24deab0c311bb5d257c29895e423824812e0bc5a5f3b46f5b5f97ccb4920b9b2495e155c1e9e89956f11986c799ac136dd6bebc17e390e52cd60a53d5c6e7c04859634720b1a5e3423d1feab1021b2e8a0dfb52664ee311d2379410995c13d74f79eef3761c0eebde0ce372ee6f38b309fcf2eba2bab4434b4b179a71T31b4b4042dea51c75492a76921254a9b0dc9c308ac154bfa48ebbd7078bc10834f50632c4f70f71e36bd724f02e89c4aceda02f7d0ade9824a14da71a68c3adf84750ba5b2b4df6d7d970057f7880f7490014dd6dfe327e002967b89c12e69d39cdebd32e0b543067ff4f530cbf7d33c29076Kebcc8a2c95d51b8bdd394a3523a7680df{5abe589c25d974039ebf05101115c61347501eff833072312cd1dc47dfb3d040434d425d5fa9eb534688c06b598f180c70f816015b88d778d6d0203280b8b02630c15934431cdcf7a201d9dabe77339b66d9dfcb536aa6093d15ab19901e07244027C7403c3e05d2f27b2991786b9d370d984e7c3a39736383a350a680f0069cb60172b7e6ae4c12d101a0593066f10f4064f07f2a3bc9e944a35d7beface954fde05d720e1dd1659ca0c1a3a4ebd8f7dd0ba02d936acb6db86d15c38e5a0900f9e2e8bae878da4d8d962b5461cb7e6}d7f427554bbec7bfc3f3c998c5e5d71"

original_seed = 31208

original_flag = reverse_shuffle(list(shuffled_flag), original_seed)

print(original_flag)
```