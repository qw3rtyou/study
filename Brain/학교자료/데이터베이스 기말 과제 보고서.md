# 주제 
비트코인 사용자 정보 관리 및 검색 서비스

# 요구사항 명세서
1. 비트코인에서는 한 사람이 여러 개의 WALLET을 이용해 비트코인을 관리할 수 있음, 이 서비스를 이용하는 사람을 USERS라고 하고, USERS는 여러 개의 WALLET을 소유할 수 있지만, WALLET은 반드시 한 USERS에 의해 소유되어야 함
2. ADDRESS가 실질적으로 비트코인을 주고 받을 수 있는 창구 역할을 함, WALLET에는 여러 개의 ADDRESS가 있지만, 하나의 ADDRESS는 반드시 하나의 WALLET에 포함되어야 함
3. 비트코인에서 블록체인은 모든 사람의 거래 정보가 담긴 데이터들의 모임임, 하나의 BLOCK에 여러 TRANSACTION를 담고 있을 수 있고, 해당 TRANSACTION에는 실질적인 거래의 상세 내역이 담겨 있음
4. 한 명의 USERS는 자신이 이 서비스에서 참여하는 목적에 따라 채굴이나 개발이 목적인 FULLNODEUSER가 될 수 있음, FULLNODE만 채굴에 참여할 수 있음
5. USERS는 userid(고유함), loginpasshash, 이름, 전화번호, 나이, 성별, 보유잔액의 정보도 가지고 있음
6. WALLET은 walletid(고유함), passhash, userid(fk), 보유잔액, 용도 정보를 가지고 있음
7. FULLNODEUSER는 fullnodeid(고유함), USERSid(fk), miningvalue의 정보를 가지고 있음
8. ADDRESS는 addressid(고유함), walletid(fk), addresshash, 총 금액 정보를 가지고 있음. ADDRESS는 반드시 하나의 WALLET에 포함되어야 하고, WALLET에는 ADDRESS가 없어도 됨
9. BLOCK은 blockid(고유함), blockhash, blockheight, 거래 수 정보를 가지고 있음
10. TRANSACTION는 txid(고유함), txhash, blockid(fk), inputuserid(fk), outputuserid(fk), 비트코인 수의 정보를 가지고 있음
11. 하나의 BLOCK에는 여러 TRANSACTION가 포함되어 있고, BLOCK에는 TRANSACTION가 없어도 되지만, 하나의 TRANSACTION는 반드시 하나의 BLOCK에 포함되어야 함
~~12. 한 명의 USERS는 여러 TRANSACTION를 생성할 수 있지만, 하나의 TRANSACTION는 반드시 한 명의 거래에 의해 생성됨~~
13. 채굴은 채굴성공id(고유함), 채굴된 blockid(fk), 성공한 fullnodeid(fk), 얻은 비트코인 수 정보를 담고 있음
14. 하나의 mining은 반드시 하나의 BLOCK을 생성
15. FULLNODEUSER는 여러 mining을 생성할 수 있지만, 하나의 mining은 반드시 한 명의 FULLNODEUSER에 의해 생성됨
16. 여기서 사용되는 해시값들은 모두 SHA-256을 사용하기 때문에 256 글자 문자열임
~~17. 블록체인에서 해당 USERS의 모든 WALLET에 있는 비트코인 수량은 USERS의 보유잔액의 값과 일치함, 마찬가지로 해당 WALLET의 모든 ADDRESS에 있는 비트코인 수량은 WALLET의 보유잔액의 값과 일치함~~
---
19. 한 명의 USERS는 여러 TRANSACTION에 input을 제공할 수 있지만, 하나의 TRANSACTION input는 반드시 한 명의 USERS에 의해 생성됨
20. 한 명의 USERS는 여러 TRANSACTION에 ouput 제공할 수 있지만, 하나의 TRANSACTION ouput 반드시 한 명의 USERS에 의해 생성됨




# ER다이어그램
![[ER다이어그램 (1).png]]



# 논리 모델링
### 관계형 모델 변환
1. **User 테이블**: 사용자 정보를 저장
- User (userid(pk), loginpasshash, name, phonenum, age, gender, balance)

2. **Wallet 테이블**: 유저의 지갑 정보를 저장
- Wallet (walletid(pk), userid(fk), passhash, balance, usage)

3. **Address 테이블**: 지갑의 주소 정보를 저장
- Address (addressid(pk), walletid(fk), addresshash, sum)

4. **Transaction 테이블**: 거래 정보를 저장
- Transaction (txid(pk), blockid(fk), inputuserid(fk), outputuserid(fk), txhash, bitcoinnum)

5. **Block 테이블**: 블록 정보를 저장
- Block (blockid(pk), blockhash, blockheight, txnum)

6. **FullNode User 테이블**: 채굴하려는 노드 사용자 정보를 저장
- FullNodeUser (fullnodeid(pk), userid(fk), miningvalue)

7. **Mining 테이블**: 채굴 정보를 저장
- Mining (miningid(pk), blockid(fk), fullnodeid(fk), bitcoinnum)


### 테이블 정의(DDL)
```sql
DROP TABLE TRANSACTION;
DROP TABLE MINING;
DROP TABLE ADDRESS;
DROP TABLE BLOCK;
DROP TABLE FULLNODEUSERS;
DROP TABLE WALLET;
DROP TABLE USERS;

-- USERS 테이블 생성
CREATE TABLE USERS (
    userid VARCHAR2(64) NOT NULL PRIMARY KEY,
    loginpasshash VARCHAR2(64) NOT NULL,
    name VARCHAR2(100) NOT NULL,
    phonenum VARCHAR2(20) NOT NULL,
    age NUMBER(3) NOT NULL CHECK (age >= 18),
    gender CHAR(1) NOT NULL CHECK (gender IN ('M', 'F')),
    balance NUMBER(19,4) NOT NULL CHECK (balance >= 0)
);

-- WALLET 테이블 생성
CREATE TABLE WALLET (
    walletid VARCHAR2(64) NOT NULL PRIMARY KEY,
    userid VARCHAR2(64) NOT NULL,
    passhash VARCHAR2(64) NOT NULL,
    balance NUMBER(19,4) NOT NULL CHECK (balance >= 0),
    usage VARCHAR2(50) NOT NULL CHECK (usage IN ('Personal', 'Business', 'Savings')),
    CONSTRAINT fk_wallet_user FOREIGN KEY (userid) REFERENCES USERS(userid)
);

-- ADDRESS 테이블 생성
CREATE TABLE ADDRESS (
    addressid VARCHAR2(64) NOT NULL PRIMARY KEY,
    walletid VARCHAR2(64) NOT NULL,
    addresshash VARCHAR2(64) NOT NULL UNIQUE,
    sum NUMBER(19,4) NOT NULL CHECK (sum >= 0),
    CONSTRAINT fk_address_wallet FOREIGN KEY (walletid) REFERENCES WALLET(walletid)
);

-- BLOCK 테이블 생성
CREATE TABLE BLOCK (
    blockid VARCHAR2(64) NOT NULL PRIMARY KEY,
    blockhash VARCHAR2(64) NOT NULL UNIQUE,
    blockheight NUMBER NOT NULL CHECK (blockheight > 0),
    txnum NUMBER NOT NULL CHECK (txnum >= 0)
);

-- TRANSACTION 테이블 생성
CREATE TABLE TRANSACTION (
    txid VARCHAR2(64) NOT NULL PRIMARY KEY,
    blockid VARCHAR2(64) NOT NULL,
    inputuserid VARCHAR2(64) NOT NULL,
    outputuserid VARCHAR2(64) NOT NULL,
    txhash VARCHAR2(64) NOT NULL UNIQUE,
    bitcoinnum NUMBER(19,4) NOT NULL CHECK (bitcoinnum > 0),
    CONSTRAINT fk_transaction_block FOREIGN KEY (blockid) REFERENCES BLOCK(blockid),
    CONSTRAINT fk_transaction_inputuser FOREIGN KEY (inputuserid) REFERENCES USERS(userid),
    CONSTRAINT fk_transaction_outputuser FOREIGN KEY (outputuserid) REFERENCES USERS(userid)
);

-- FULLNODEUSERS 테이블 생성
CREATE TABLE FULLNODEUSERS (
    fullnodeid VARCHAR2(64) NOT NULL PRIMARY KEY,
    userid VARCHAR2(64) NOT NULL,
    miningvalue NUMBER(19,4) NOT NULL CHECK (miningvalue >= 0),
    CONSTRAINT fk_fullnodeuser_user FOREIGN KEY (userid) REFERENCES USERS(userid)
);

-- MINING 테이블 생성
CREATE TABLE MINING (
    miningid VARCHAR2(64) NOT NULL PRIMARY KEY,
    blockid VARCHAR2(64) NOT NULL,
    fullnodeid VARCHAR2(64) NOT NULL,
    bitcoinnum NUMBER(19,4) NOT NULL CHECK (bitcoinnum > 0),
    CONSTRAINT fk_mining_block FOREIGN KEY (blockid) REFERENCES BLOCK(blockid),
    CONSTRAINT fk_mining_fullnodeuser FOREIGN KEY (fullnodeid) REFERENCES FULLNODEUSERS(fullnodeid)
);


INSERT INTO USERS (userid, loginpasshash, name, phonenum, age, gender, balance) VALUES ('user001', '5f4dcc3b5aa765d61d8327deb882cf99', 'John Doe', '010-1234-5678', 28, 'M', 50.00);
INSERT INTO USERS (userid, loginpasshash, name, phonenum, age, gender, balance) VALUES ('user002', '7c6a180b36896a0a8c02787eeafb0e4c', 'Jane Smith', '010-2345-6789', 32, 'F', 3.75);
INSERT INTO USERS (userid, loginpasshash, name, phonenum, age, gender, balance) VALUES ('user003', '12f783d24c92f9d3fc6c1f99f30870a5', 'Alice Johnson', '010-3456-7890', 22, 'F', 15.50);
INSERT INTO USERS (userid, loginpasshash, name, phonenum, age, gender, balance) VALUES ('user004', '5ebe2294ecd0e0f08eab7690d2a6ee69', 'Robert Brown', '010-4567-8901', 45, 'M', 7.50);
INSERT INTO USERS (userid, loginpasshash, name, phonenum, age, gender, balance) VALUES ('user005', '8ad8757baa8564dc136c1e07507f4a98', 'Emily White', '010-5678-9012', 29, 'F', 4.00);
INSERT INTO USERS (userid, loginpasshash, name, phonenum, age, gender, balance) VALUES ('user006', '25d55ad283aa400af464c76d713c07ad', 'Michael Green', '010-6789-0123', 33, 'M', 0.25);
INSERT INTO USERS (userid, loginpasshash, name, phonenum, age, gender, balance) VALUES ('user007', 'e99a18c428cb38d5f260853678922e03', 'Chloe Black', '010-7890-1234', 26, 'F', 2.00);
INSERT INTO USERS (userid, loginpasshash, name, phonenum, age, gender, balance) VALUES ('user008', 'fcea920f7412b5da7be0cf42b8c93759', 'David Lee', '010-8901-2345', 39, 'M', 6.00);
INSERT INTO USERS (userid, loginpasshash, name, phonenum, age, gender, balance) VALUES ('user009', '7c222fb2927d828af22f592134e8932480637c0d', 'Sophia Hall', '010-9012-3456', 24, 'F', 5.50);
INSERT INTO USERS (userid, loginpasshash, name, phonenum, age, gender, balance) VALUES ('user010', '5f4dcc3b5aa765d61d8327deb882cf99', 'James Wilson', '010-0123-4567', 37, 'M', 4.75);


INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet01', 'user001', 'a87ff679a2f3e71d9181a67b7542122c', 5.00, 'Personal');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet02', 'user002', 'e4da3b7fbbce2345d7772b0674a318d5', 3.00, 'Business');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet03', 'user001', '1679091c5a880faf6fb5e6087eb1b2dc', 2.00, 'Savings');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet04', 'user003', '8f14e45fceea167a5a36dedd4bea2543', 1.50, 'Personal');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet05', 'user004', 'c9f0f895fb98ab9159f51fd0297e236d', 0.75, 'Business');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet06', 'user005', '45c48cce2e2d7fbdea1afc51c7c6ad26', 0.40, 'Personal');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet07', 'user006', 'd3d9446802a44259755d38e6d163e820', 0.25, 'Savings');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet08', 'user007', '6512bd43d9caa6e02c990b0a82652dca', 0.20, 'Business');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet09', 'user008', 'c20ad4d76fe97759aa27a0c99bff6710', 0.60, 'Personal');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet10', 'user009', 'c51ce410c124a10e0db5e4b97fc2af39', 0.55, 'Savings');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet11', 'user010', 'aab3238922bcc25a6f606eb525ffdc56', 0.475, 'Business');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet12', 'user002', '9bf31c7ff062936a96d3c8bd1f8f2ff3', 1.00, 'Personal');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet13', 'user003', 'c74d97b01eae257e44aa9d5bade97baf', 0.80, 'Savings');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet14', 'user005', '70efdf2ec9b086079795c442636b55fb', 0.30, 'Business');
INSERT INTO WALLET (walletid, userid, passhash, balance, usage) VALUES ('wallet15', 'user006', '6f4922f45568161a8cdf4ad2299f6d23', 0.10, 'Personal');


INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address01', 'wallet01', 'a87ff679a2f3e71d9181a67b7542122c', 0.02);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address02', 'wallet02', 'e4da3b7fbbce2345d7772b0674a318d5', 0.01);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address03', 'wallet03', '1679091c5a880faf6fb5e6087eb1b2dc', 0.015);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address04', 'wallet04', '8f14e45fceea167a5a36dedd4bea2543', 0.005);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address05', 'wallet05', 'c9f0f895fb98ab9159f51fd0297e236d', 0.0075);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address06', 'wallet06', '45c48cce2e2d7fbdea1afc51c7c6ad26', 0.002);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address07', 'wallet07', 'd3d9446802a44259755d38e6d163e820', 0.0015);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address08', 'wallet08', '6512bd43d9caa6e02c990b0a82652dca', 0.001);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address09', 'wallet09', 'c20ad4d76fe97759aa27a0c99bff6710', 0.003);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address10', 'wallet10', 'c51ce410c124a10e0db5e4b97fc2af39', 0.004);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address11', 'wallet11', 'aab3238922bcc25a6f606eb525ffdc56', 0.0035);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address12', 'wallet12', '9bf31c7ff062936a96d3c8bd1f8f2ff3', 0.0025);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address13', 'wallet13', 'c74d97b01eae257e44aa9d5bade97baf', 0.00175);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address14', 'wallet14', '70efdf2ec9b086079795c442636b55fb', 0.00225);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address15', 'wallet15', '6f4922f45568161a8cdf4ad2299f6d23', 0.00075);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address16', 'wallet01', '1f0e3dad99908345f7439f8ffabdffc4', 0.01);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address17', 'wallet02', '98f13708210194c475687be6106a3b84', 0.005);
INSERT INTO ADDRESS (addressid, walletid, addresshash, sum) VALUES ('address18', 'wallet03', '3c59dc048e8850243be8079a5c74d079', 0.01);

 
INSERT INTO BLOCK (blockid, blockhash, blockheight, txnum) VALUES ('block01', 'hashblock01', 1, 5);
INSERT INTO BLOCK (blockid, blockhash, blockheight, txnum) VALUES ('block02', 'hashblock02', 2, 3);
INSERT INTO BLOCK (blockid, blockhash, blockheight, txnum) VALUES ('block03', 'hashblock03', 3, 7);
INSERT INTO BLOCK (blockid, blockhash, blockheight, txnum) VALUES ('block04', 'hashblock04', 4, 4);
INSERT INTO BLOCK (blockid, blockhash, blockheight, txnum) VALUES ('block05', 'hashblock05', 5, 6);
INSERT INTO BLOCK (blockid, blockhash, blockheight, txnum) VALUES ('block06', 'hashblock06', 6, 2);
INSERT INTO BLOCK (blockid, blockhash, blockheight, txnum) VALUES ('block07', 'hashblock07', 7, 5);


INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx01', 'block01', 'user001', 'user002', 'a87ff679a2f3e71d9181a67b7542122c', 0.01);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx02', 'block01', 'user002', 'user003', 'e4da3b7fbbce2345d7772b0674a318d5', 0.02);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx03', 'block02', 'user003', 'user004', '1679091c5a880faf6fb5e6087eb1b2dc', 0.015);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx04', 'block02', 'user004', 'user005', '8f14e45fceea167a5a36dedd4bea2543', 0.005);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx05', 'block03', 'user005', 'user006', 'c9f0f895fb98ab9159f51fd0297e236d', 0.0075);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx06', 'block03', 'user006', 'user007', '45c48cce2e2d7fbdea1afc51c7c6ad26', 0.002);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx07', 'block04', 'user007', 'user008', 'd3d9446802a44259755d38e6d163e820', 0.0015);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx08', 'block04', 'user008', 'user009', '6512bd43d9caa6e02c990b0a82652dca', 0.001);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx09', 'block05', 'user009', 'user010', 'c20ad4d76fe97759aa27a0c99bff6710', 0.003);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx10', 'block05', 'user010', 'user001', 'c51ce410c124a10e0db5e4b97fc2af39', 0.004);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx11', 'block06', 'user001', 'user002', 'aab3238922bcc25a6f606eb525ffdc56', 0.0035);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx12', 'block06', 'user002', 'user003', '9bf31c7ff062936a96d3c8bd1f8f2ff3', 0.0025);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx13', 'block07', 'user003', 'user004', 'c74d97b01eae257e44aa9d5bade97baf', 0.00175);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx14', 'block07', 'user004', 'user005', '70efdf2ec9b086079795c442636b55fb', 0.00225);
INSERT INTO TRANSACTION (txid, blockid, inputuserid, outputuserid, txhash, bitcoinnum) VALUES ('tx15', 'block01', 'user005', 'user006', '6f4922f45568161a8cdf4ad2299f6d23', 0.00075);


INSERT INTO FULLNODEUSERS (fullnodeid, userid, miningvalue) VALUES ('fullnode01', 'user001', 10.00);
INSERT INTO FULLNODEUSERS (fullnodeid, userid, miningvalue) VALUES ('fullnode02', 'user002', 15.00);
INSERT INTO FULLNODEUSERS (fullnodeid, userid, miningvalue) VALUES ('fullnode03', 'user003', 20.00);
INSERT INTO FULLNODEUSERS (fullnodeid, userid, miningvalue) VALUES ('fullnode04', 'user004', 25.00);
INSERT INTO FULLNODEUSERS (fullnodeid, userid, miningvalue) VALUES ('fullnode05', 'user005', 30.00);


INSERT INTO MINING (miningid, blockid, fullnodeid, bitcoinnum) VALUES ('mining01', 'block01', 'fullnode01', 0.05);
INSERT INTO MINING (miningid, blockid, fullnodeid, bitcoinnum) VALUES ('mining02', 'block02', 'fullnode02', 0.03);
INSERT INTO MINING (miningid, blockid, fullnodeid, bitcoinnum) VALUES ('mining03', 'block03', 'fullnode03', 0.02);
INSERT INTO MINING (miningid, blockid, fullnodeid, bitcoinnum) VALUES ('mining04', 'block04', 'fullnode04', 0.015);
INSERT INTO MINING (miningid, blockid, fullnodeid, bitcoinnum) VALUES ('mining05', 'block05', 'fullnode01', 0.01);
INSERT INTO MINING (miningid, blockid, fullnodeid, bitcoinnum) VALUES ('mining06', 'block06', 'fullnode01', 0.0075);
INSERT INTO MINING (miningid, blockid, fullnodeid, bitcoinnum) VALUES ('mining07', 'block07', 'fullnode02', 0.004);

```


### DDL문 실행 화면
![[Pasted image 20231203132815.png]]


# 구현
### 쿼리1
- 0.01 비트코인 이상의 거래를 한 사용자들의 지갑의 상세 정보를 그들의 지갑 잔액 기준으로 조회
- 0.01 부분을 조절해서 거래를 하지 않는 사람이나, 특정 거래 한도를 넘어가는 사람을 알아낼 수 있음

- sql
```sql
SELECT u.name, w.walletid, w.balance
FROM USERS u
JOIN WALLET w ON u.userid = w.userid
WHERE u.userid IN (
    SELECT t.inputuserid
    FROM TRANSACTION t
    WHERE t.bitcoinnum > 0.01
)
ORDER BY w.balance DESC;
```

- 실행결과
![[Pasted image 20231203135831.png]]

### 쿼리2
- 블록당 평균 트랜잭션 수보다 많은 트랜잭션이 있는 모든 블록을 트랙잭션 수 기준으로 해당 트랜잭션 수와 함께 조회
- 특정 기간에 거래량이 얼마나 많았는지를 알 수 있음

- sql
```sql
SELECT b.blockid, b.txnum
FROM BLOCK b
WHERE b.txnum > (
    SELECT AVG(txnum) 
    FROM BLOCK
)
ORDER BY b.txnum DESC;
```

- 실행결과
![[Pasted image 20231203140314.png]]


### 쿼리3
-  채굴한 사용자를 찾아 사용자 별로 채굴한 총 블록 수를 조회
- 채굴 효율이 높은 순으로 유저를 조회할 수 있음

- sql
```sql
SELECT fu.userid, COUNT(m.blockid) AS total_mined_blocks
FROM FULLNODEUSERS fu
JOIN MINING m ON fu.fullnodeid = m.fullnodeid
GROUP BY fu.userid
ORDER BY total_mined_blocks DESC;
```

- 실행결과
![[Pasted image 20231203141613.png]]

### 쿼리4
- 각 블럭의 최소 거래 최대 거래 조회

- sql
```sql
SELECT b.blockid, MAX(t.bitcoinnum) AS max_transaction_amount, MIN(t.bitcoinnum) AS min_transaction_amount
FROM BLOCK b
JOIN TRANSACTION t ON b.blockid = t.blockid
GROUP BY b.blockid;
```

- 실행결과
![[Pasted image 20231203143834.png]]


### 쿼리5
- 지갑에 있는 평균적인 balance보다 큰 지갑에 대해 지갑의 balance와 각각의 지갑이 소유하고 있는 주소의 수를 조회

- sql
```sql
SELECT w.walletid, w.balance, COUNT(a.addressid) AS address_count
FROM WALLET w
JOIN ADDRESS a ON w.walletid = a.walletid
GROUP BY w.walletid, w.balance
HAVING w.balance > (
    SELECT AVG(balance) 
    FROM WALLET
)
ORDER BY w.balance DESC;
```

- 실행결과
![[Pasted image 20231203144033.png]]



# 기타
### 정규화 여부
- 모든 테이블의 필드가 원자적임(1NF)
- 모든 테이블이 완전 함수적으로 의존하고 있음(2NF), 모든 테이블의 기본키는 하나임
- 이행적 함수적 의존성이 없음(3NF), 특정 필드가 다른 필드를 의존하지 않음
- 기본 키 외의 다른 필드가 데이터를 결정하는 상황이 없음(BCNF)
- 예를 들어, `USERS` 테이블에서 `userid`는 다른 모든 필드(`name`, `phonenum`, `age`, `gender`, `balance`)의 값을 결정함
- 즉, 이미 정규화를 고려하여 작성했으므로 수정할 것은 없음


### 속성, 제약조건 설명
- 모든 해시값과 관련된 데이터는 SHA256을 사용하기 때문에 `VARCHAR2(64)`로 제한함
- 비트코인의 양, 블럭 높이 등등 어떤 수량은 0 이상의 값을 가져야 하기 때문에 CHECK로 제한함